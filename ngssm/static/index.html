<!DOCTYPE html>
<html>
<head>
<title>Metagenomics Sample Client Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.13.3/jquery.tablesorter.min.js"></script>
</head>
<body>
	<div class="navbar">
		<div class="navbar-inner">
			<a class="brand" href="#">Metagenomics Sample Client Demo</a>
			<ul class="nav">
				<li class="active"><a href="#">Home</a></li>
				<li><a href="#">Runs</a></li>
				<li><a href="#">Link</a></li>
			</ul>
		</div>
	</div>
	<div id="main" class="container">
		<table id="sampleTable" class="table table-striped">
			<tr>
				<td><b>Plate</b></td>
				<td><b>SFF</b></td>
				<td><b>MID</b></td>
				<td><b>Target</b></td>
				<td><b>Details</b></td>
				<td><b>Options</b></td>
			</tr>
			<!-- ko foreach: samples -->
			<tr>
				<td>
						<p><b data-bind="text: plate"></b></p>
				</td>
				<td>
						<p><b data-bind="text: sff"></b></p>
				</td>
				<td>
						<p><b data-bind="text: mid"></b></p>
				</td>
				<td>
						<p><b data-bind="text: target"></b></p>
				</td>
				<td>
						<p><b data-bind="text: mid_set"></b></p>
						<p><b data-bind="text: uri"></b></p>
				</td>
				<td>
					<button data-bind="click: $parent.beginEdit" class="btn">Edit</button>
					<button data-bind="click: $parent.remove" class="btn">Delete</button>
				</td>
			</tr>
			<!-- /ko -->
		</table>
		<button data-bind="click: beginAdd" class="btn">Add Sample</button>
	</div>
	<div id="add" class="modal hide fade" tabindex="=1" role="dialog" aria-labelledby="addDialogLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="addDialogLabel">Add Sample</h3>
		</div>
		<div class="modal-body">
			<form class="form-horizontal">
				<div class="control-group">
					<label class="control-label" for="inputTask">Plate</label>
					<div class="controls">
						<input data-bind="value: plate" type="text" id="inputPlate" placeholder="Plate" style="width: 150px;">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputDescription">SFF Filename</label>
					<div class="controls">
						<input data-bind="value: sff" type="text" id="inputSFF" placeholder="SFF Filename" style="width: 300px;">
					</div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button data-bind="click: addSample" class="btn btn-primary">Add Sample</button>
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
		</div>
	</div>
	<div id="edit" class="modal hide fade" tabindex="=1" role="dialog" aria-labelledby="editDialogLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="editDialogLabel">Edit Sample</h3>
		</div>
		<div class="modal-body">
			<form class="form-horizontal">
				<div class="control-group">
					<label class="control-label" for="inputPlate">Plate</label>
					<div class="controls">
						<input data-bind="value: plate" type="text" id="inputPlate" placeholder="Plate" style="width: 150px;">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputSFF">SFF Filename</label>
					<div class="controls">
						<input data-bind="value: sff" type="text" id="inputSFF" placeholder="SFF Filename" style="width: 300px;">
					</div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button data-bind="click: editSample" class="btn btn-primary">Edit Sample</button>
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
		</div>
	</div>
	<div id="login" class="modal hide fade" tabindex="=1" role="dialog" aria-labelledby="loginDialogLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="loginDialogLabel">Login</h3>
		</div>
		<div class="modal-body">
			<form class="form-horizontal">
				<div class="control-group">
					<label class="control-label" for="inputUsername">Username</label>
					<div class="controls">
						<input data-bind="value: username" type="text" id="inputUsername" placeholder="username" style="width: 150px;">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputPassword">Password</label>
					<div class="controls">
						<input data-bind="value: password" type="text" id="inputPassword" placeholder="password" style="width: 300px;">
					</div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button data-bind="click: login" class="btn btn-primary">Login</button>
		</div>
	</div>


	<script type="text/javascript" src="scripts/login.js"></script>
	<script type="text/javascript" src="scripts/samples.js"></script>

	<script>
		var loginViewModel = new LoginViewModel();
		ko.applyBindings(loginViewModel, $('#login')[0]);

		var samplesViewModel = new SamplesViewModel(loginViewModel);
		var addSamplesViewModel = new AddSamplesViewModel(loginViewModel);
		var editSamplesViewModel = new EditSamplesViewModel(loginViewModel);
		ko.applyBindings(samplesViewModel, $('#main')[0]);
		ko.applyBindings(addSamplesViewModel, $('#add')[0]);
		ko.applyBindings(editSamplesViewModel, $('#edit')[0]);

		loginViewModel.loginHandler = function (username, password) {
			samplesViewModel.ajax(samplesViewModel.samplesURI, 'GET').done(function(data) {
				for (var i = 0; i < data.samples.length; i++) {
					samplesViewModel.samples.push({
						uri: ko.observable(data.samples[i].uri),
						sff: ko.observable(data.samples[i].sff),
						target: ko.observable(data.samples[i].target),
						mid: ko.observable(data.samples[i].mid),
						mid_set: ko.observable(data.samples[i].mid_set),
						run: ko.observable(data.samples[i].run),
					});
				}
			}).fail(function(jqXHR) {
				if(jqXHR.status = 403) {
					setTimeout(self.beginLogin, 500);
				}
			});
		}
		loginViewModel.beginLogin();
	</script>

	<script>
		$(document).ready(function(){
			$(function(){
				$("#sampleTable").tablesorter();
			});
		});
	</script>
</body>
</html>
